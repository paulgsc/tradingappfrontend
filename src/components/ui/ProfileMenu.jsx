import { useDispatch, useSelector } from "react-redux";
import { broadcastLogout } from "../../contexts/redux/actions/userActions";
import { Link } from "react-router-dom";
import UserLetterIcon from "./UserLetterIcon";
import { useQueryClient } from "@tanstack/react-query";

function ProfileMenu() {
  const dispatch = useDispatch();
  const queryClient = useQueryClient();
  const { userInfo: { email, username, is_admin, profile_img } = {} } =
    useSelector((state) => state.userAuth);
  const handleSignOut = () => {
    dispatch(broadcastLogout());
    queryClient.clear();
  };
  return (
    <div tabIndex={-1} className="group relative">
      <button
        type="button"
        className="flex mx-3 text-sm bg-gray-800 rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300"
        id="user-menu-button"
        aria-expanded="false"
        data-dropdown-toggle="dropdown"
      >
        <span className="sr-only">Open user menu</span>
        {profile_img ? (
          <img
            className="w-8 h-8 rounded-full"
            src={profile_img}
            alt="user photo"
          />
        ) : (
          <UserLetterIcon />
        )}
      </button>

      <div
        className="z-50 hidden absolute right-0 group-focus-within:block my-4 w-56 text-base list-none bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600"
        id="dropdown"
      >
        <div className="py-3 px-4">
          <span className="block text-sm font-semibold text-gray-900 dark:text-white">
            {username}
          </span>
          <span className="block text-sm font-light text-gray-500 truncate dark:text-gray-400">
            {email}
          </span>
        </div>
        <ul
          className="py-1 font-light text-gray-500 dark:text-gray-400"
          aria-labelledby="dropdown"
        >
          <li>
            <Link
              to={"/personal/myprofile"}
              className="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
            >
              My profile
            </Link>
          </li>
          <li>
            <a
              href="#"
              className="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
            >
              Account settings
            </a>
          </li>
        </ul>
        <ul
          className="py-1 font-light text-gray-500 dark:text-gray-400"
          aria-labelledby="dropdown"
        >
          <li>
            <a
              href="#"
              className="flex items-center py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
            >
              <svg
                className="mr-2 w-5 h-5 text-gray-400"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                  clipRule="evenodd"
                ></path>
              </svg>{" "}
              My likes
            </a>
          </li>
          <li>
            <Link
              to={"/personal/myhistory/orders"}
              className="flex items-center py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
            >
              <svg
                className="mr-2 w-5 h-5 text-gray-400"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path>
              </svg>{" "}
              History
            </Link>
          </li>
          {is_admin && (
            <li>
              <Link
                to={"/admin/dashboard"}
                className="flex justify-between items-center py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
              >
                <span className="inline-flex items-center justify-center space-x-2">
                  <svg
                    className="w-5 h-5"
                    viewBox="0 0 48 48"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M18.1254 29.6279C18.1254 29.6279 17.3814 28.9073 16.8786 29.0308C11.4745 30.3589 6 33.0668 6 37.1404V41.9997V43.9997H8H40H42V41.9997V37.1404C42 33.0668 36.5255 30.3589 31.1214 29.0308C30.6186 28.9073 29.8746 29.6279 29.8746 29.6279C29.8746 29.6279 24.2271 32.9997 23.5474 32.9996C23.5329 32.9996 18.1254 29.6279 18.1254 29.6279ZM30.6539 30.9331L29.8746 29.6279C30.2628 30.2781 30.504 30.6821 30.6539 30.9331L30.6539 30.9331ZM30.6539 30.9332L30.6539 30.9332C30.6641 30.9502 30.6738 30.9665 30.6831 30.9821C30.6832 30.9821 30.6832 30.9821 30.6832 30.9821L30.6539 30.9332ZM30.6836 30.9828C30.6836 30.9828 30.6835 30.9828 30.6835 30.9828C30.8998 31.3451 30.8998 31.3452 30.8997 31.3452L30.8995 31.3454L30.8985 31.3459L30.8951 31.348L30.8822 31.3557L30.8333 31.3848L30.6494 31.4938C30.4913 31.5875 30.2651 31.7209 29.9919 31.8808C29.4461 32.2002 28.7087 32.6277 27.9473 33.0565C27.1905 33.4826 26.3904 33.9213 25.7254 34.2576C25.396 34.4242 25.0717 34.58 24.789 34.6987C24.649 34.7575 24.4903 34.8195 24.3292 34.8701C24.2179 34.905 23.9117 34.9997 23.5472 34.9996C23.2899 34.983 22.9436 34.9064 22.8517 34.8748C22.805 34.8568 22.7308 34.8254 22.7032 34.8128C22.6541 34.7899 22.6166 34.77 22.605 34.7638C22.5755 34.7481 22.5524 34.7348 22.5456 34.7309C22.5272 34.7203 22.511 34.7106 22.5031 34.7059C22.4843 34.6946 22.4624 34.6813 22.441 34.6682C22.3964 34.641 22.3344 34.6028 22.2591 34.5563C22.1078 34.4628 21.8937 34.3301 21.6389 34.1718C21.1289 33.8551 20.4508 33.4331 19.7738 33.0115C19.0966 32.5899 18.42 32.1682 17.9127 31.8521L17.2997 31.47L17.128 31.3629L17.0827 31.3347L17.0711 31.3275L17.0682 31.3256L17.0674 31.3252L17.0672 31.325L17.2741 30.9933C17.274 30.9933 17.274 30.9933 17.274 30.9933L17.0672 31.325L16.8867 31.2125L16.7889 31.1178C14.4136 31.7468 12.166 32.6327 10.5162 33.7241C8.69262 34.9304 8 36.0992 8 37.1404V41.9997H40V37.1404C40 36.0992 39.3074 34.9304 37.4838 33.7241C35.834 32.6327 33.5864 31.7468 31.2111 31.1178L31.0993 31.2261L30.8999 31.3451L30.6836 30.9828ZM17.2757 30.9906C17.2757 30.9905 17.2758 30.9905 17.2758 30.9905L17.3363 30.8935L17.3363 30.8934L17.2757 30.9906ZM17.3363 30.8933L18.1254 29.6279L17.3363 30.8934L17.3363 30.8933Z"
                      fill="#333333"
                    />
                    <path
                      d="M12 37.9996C12 37.4473 12.4477 36.9996 13 36.9996H18C18.5523 36.9996 19 37.4473 19 37.9996C19 38.5519 18.5523 38.9996 18 38.9996H13C12.4477 38.9996 12 38.5519 12 37.9996Z"
                      fill="#333333"
                    />
                    <path
                      d="M32.8026 34.15C32.8647 33.9495 33.1353 33.9495 33.1975 34.15L33.7633 35.9746C33.7911 36.0642 33.8709 36.1249 33.9608 36.1249H35.792C35.9931 36.1249 36.0768 36.3945 35.914 36.5184L34.4326 37.646C34.3598 37.7015 34.3293 37.7996 34.3571 37.8892L34.923 39.7139C34.9852 39.9142 34.7662 40.081 34.6035 39.9571L33.1221 38.8293C33.0493 38.774 32.9508 38.774 32.878 38.8293L31.3965 39.9571C31.2338 40.081 31.0148 39.9142 31.077 39.7139L31.6429 37.8892C31.6707 37.7996 31.6403 37.7015 31.5675 37.646L30.086 36.5184C29.9232 36.3945 30.0069 36.1249 30.208 36.1249H32.0392C32.1291 36.1249 32.2089 36.0642 32.2367 35.9746L32.8026 34.15Z"
                      fill="white"
                    />
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M33.2395 34.2855L33.1975 34.15C33.1353 33.9495 32.8647 33.9495 32.8026 34.15L32.2367 35.9746C32.2089 36.0642 32.1291 36.1249 32.0392 36.1249H30.208C30.0069 36.1249 29.9232 36.3945 30.086 36.5184L31.5675 37.646C31.6403 37.7015 31.6707 37.7996 31.6429 37.8892L31.077 39.7139C31.0148 39.9142 31.2338 40.081 31.3965 39.9571L32.878 38.8293C32.9508 38.774 33.0493 38.774 33.1221 38.8293L34.6035 39.9571C34.7662 40.081 34.9852 39.9142 34.923 39.7139L34.3571 37.8892C34.3293 37.7996 34.3598 37.7015 34.4326 37.646L35.914 36.5184C36.0768 36.3945 35.9931 36.1249 35.792 36.1249H33.9608C33.8709 36.1249 33.7911 36.0642 33.7633 35.9746L33.2395 34.2855Z"
                      fill="#333333"
                    />
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M15 17V15H17V17C17 20.866 20.134 24 24 24C27.866 24 31 20.866 31 17V15H33V17C33 21.9706 28.9706 26 24 26C19.0294 26 15 21.9706 15 17Z"
                      fill="#333333"
                    />
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M24.1567 3.01241L24 4.00006L23.8433 3.01241L24 2.98755L24.1567 3.01241ZM34.0101 13.2962C34.0336 13.2604 34.0588 13.2215 34.0854 13.1797C34.2491 12.923 34.469 12.5538 34.7044 12.0894C35.1737 11.1637 35.7142 9.84173 35.9855 8.26656C36.1148 7.51569 35.7236 6.92507 35.3406 6.5496C34.9536 6.17016 34.4288 5.8557 33.8841 5.59139C32.7818 5.05662 31.3187 4.5965 29.9028 4.22316C28.4739 3.8464 27.0383 3.54411 25.9639 3.33647C25.4257 3.23245 24.9758 3.15174 24.6597 3.09692C24.5016 3.0695 24.3769 3.04854 24.2912 3.03435L24.1926 3.01818L24.1665 3.01398L24.1567 3.01241C24.1565 3.01238 24.1567 3.01241 24 4.00006C23.8433 3.01241 23.8435 3.01238 23.8433 3.01241L23.8335 3.01398L23.8076 3.01816L23.7094 3.03425C23.6241 3.04838 23.4999 3.06926 23.3425 3.09656C23.0279 3.15116 22.5799 3.23156 22.0439 3.33523C20.9739 3.54218 19.5436 3.84363 18.1182 4.21984C16.7055 4.59269 15.2448 5.05244 14.1404 5.58728C13.5942 5.85183 13.0692 6.16562 12.6798 6.54291C12.2963 6.91454 11.9011 7.49644 12.0106 8.24219C12.2443 9.83255 12.7898 11.1655 13.2719 12.0969C13.5139 12.5643 13.7426 12.9359 13.9137 13.1943C13.9407 13.2351 13.9664 13.2732 13.9905 13.3085C13.9972 13.4601 14.0173 13.641 14.0625 13.8432C14.1859 14.3953 14.4899 15.0736 15.1572 15.7189C16.4709 16.9893 19.0445 18.0001 24 18.0001C28.9555 18.0001 31.5291 16.9893 32.8428 15.7189C33.5101 15.0736 33.8141 14.3953 33.9375 13.8432C33.9839 13.6356 34.0039 13.4503 34.0101 13.2962ZM31.7015 14.0001H16.2985C16.3655 14.0901 16.4474 14.1844 16.5475 14.2812C17.3021 15.0109 19.2284 16.0001 24 16.0001C28.7716 16.0001 30.6979 15.0109 31.4525 14.2812C31.5526 14.1844 31.6345 14.0901 31.7015 14.0001ZM15.5225 12.0001H32.4646C32.5904 11.7968 32.7499 11.5216 32.9206 11.1849C33.3152 10.4067 33.7607 9.31671 33.9952 8.03564C33.9821 8.02029 33.9642 8.00102 33.9404 7.97768C33.7797 7.82015 33.479 7.61784 33.011 7.39079C32.0877 6.94283 30.7762 6.52181 29.3929 6.15707C28.0225 5.79574 26.6341 5.503 25.5844 5.30014C25.0606 5.1989 24.6234 5.12049 24.3179 5.0675C24.1862 5.04465 24.079 5.02654 24 5.01338C23.9215 5.02646 23.8152 5.04444 23.6845 5.06712C23.3804 5.11987 22.9452 5.19796 22.4237 5.29884C21.3784 5.50099 19.9954 5.79287 18.6286 6.15362C17.2491 6.51772 15.9387 6.93854 15.0122 7.38728C14.543 7.61452 14.2377 7.81826 14.0716 7.97918C14.0409 8.00896 14.0193 8.03268 14.0045 8.05058C14.2052 9.32064 14.6471 10.403 15.048 11.1774C15.2249 11.5192 15.3918 11.7971 15.5225 12.0001ZM13.9749 8.09274C13.9746 8.09276 13.9757 8.09018 13.979 8.08492C13.9768 8.09008 13.9752 8.09271 13.9749 8.09274ZM34.029 8.08188C34.0288 8.08186 34.0271 8.07932 34.0249 8.07436C34.0282 8.07943 34.0293 8.08191 34.029 8.08188Z"
                      fill="#333333"
                    />
                    <path
                      d="M26.5 7.33333C26.5 7.33333 24.6667 6.66667 24 6C23.3333 6.66667 21.5 7.33333 21.5 7.33333C21.5 7.33333 22 11 24 11C26 11 26.5 7.33333 26.5 7.33333Z"
                      fill="#333333"
                    />
                  </svg>
                  <span> Admin Portal</span>
                </span>
              </Link>
            </li>
          )}
        </ul>
        <ul
          className="py-1 font-light text-gray-500 dark:text-gray-400"
          aria-labelledby="dropdown"
        >
          <li>
            <button
              onClick={handleSignOut}
              className="inline-flex items-center w-full space-x-2 py-2 px-4 text-sm hover:bg-gray-100 "
            >
              <span>Sign out</span>
              <svg
                className="w-3 h-3"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 16 16"
              >
                <path
                  stroke="currentColor"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="2"
                  d="M4 8h11m0 0-4-4m4 4-4 4m-5 3H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h3"
                />
              </svg>
            </button>
          </li>
        </ul>
      </div>
    </div>
  );
}

export default ProfileMenu;
